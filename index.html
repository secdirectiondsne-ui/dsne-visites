<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visites | DSNE</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        .table-container {
            overflow-x: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background-color: #4CAF50;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #ddd;
        }
        
        td {
            padding: 8px;
            border: 1px solid #ddd;
        }
        
        .data-button {
            background-color: #FFD700;
            color: black;
            border: none;
            padding: 8px 16px;
            text-align: left;
            display: block;
            width: 100%;
            cursor: default;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .carte-button {
            background-color: #DC143C;
            color: white;
            border: none;
            padding: 8px 16px;
            text-align: left;
            display: block;
            width: 100%;
            cursor: default;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Visites | DSNE</h1>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Horodateur</th>
                    <th>Adresse e-mail</th>
                    <th>Nom de Famille</th>
                    <th>Prenom</th>
                    <th>Service Visite</th>
                    <th>CIN/NIF</th>
                    <th>Institution</th>
                    <th>Numero de Carte Visite</th>
                    <th>Nom de La Formation</th>
                </tr>
            </thead>
            <tbody id="dataBody">
                <tr>
                    <td colspan="9" style="text-align:center;">Chargement des donnees...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        // Google Sheet ID
        const SHEET_ID = '1VGUm9KutnebwPBJCeOu9sa6sUY8w2kp9jEDY8u_Aj6Q';
        const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

        async function fetchAndDisplayData() {
            const tbody = document.getElementById('dataBody');
            tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;">Chargement des donnees...</td></tr>';

            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        displayData(results.data);
                    },
                    error: function(error) {
                        console.error('Erreur de parsing:', error);
                        tbody.innerHTML = '<tr><td colspan="9" style="text-align:center; color:red;">Erreur lors du chargement des donnees</td></tr>';
                    }
                });
            } catch (error) {
                console.error('Erreur:', error);
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center; color:red;">Erreur de connexion. Assurez-vous que la feuille est publiee.</td></tr>';
            }
        }

        function displayData(data) {
            const tbody = document.getElementById('dataBody');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;">Aucune donnee disponible</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            
            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><button class="data-button">${row['Horodateur'] || ''}</button></td>
                    <td><button class="data-button">${row['Adresse e-mail'] || ''}</button></td>
                    <td><button class="data-button">${row['Nom de Famille'] || ''}</button></td>
                    <td><button class="data-button">${row['Prenom'] || ''}</button></td>
                    <td><button class="data-button">${row['Service Visite'] || row['Service Visit√©'] || ''}</button></td>
                    <td><button class="data-button">${row['CIN/NIF'] || ''}</button></td>
                    <td><button class="data-button">${row['Institution'] || ''}</button></td>
                    <td><button class="carte-button">${row['Numero de Carte Visite'] || ''}</button></td>
                    <td><button class="data-button">${row['Nom de La Formation'] || ''}</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Load data when page loads
        window.addEventListener('DOMContentLoaded', fetchAndDisplayData);
        
        // Optional: Refresh data every 30 seconds
        setInterval(fetchAndDisplayData, 30000);
    </script>
</body>
</html>